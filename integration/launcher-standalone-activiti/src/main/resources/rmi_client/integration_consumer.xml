<?xml version="1.0" encoding="UTF-8"?>
<!--
 Copyright (c) 2015-2017 Linagora
 
 This program/library is free software: you can redistribute it and/or modify
 it under the terms of the New BSD License (3-clause license).

 This program/library is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 FITNESS FOR A PARTICULAR PURPOSE. See the New BSD License (3-clause license)
 for more details.

 You should have received a copy of the New BSD License (3-clause license)
 along with this program/library; If not, see http://directory.fsf.org/wiki/License:BSD_3Clause/
 for the New BSD License (3-clause license).
-->
<tns:integration xmlns:tns="http://org.ow2.petals/RMIClientUtil" 
		xmlns:generatedNs="http://petals.ow2.org/"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 		xmlns:soap="http://petals.ow2.org/components/soap/version-4" >

	<tns:consumer endpoint="IntegrationServiceSOAPHttpSoap11Endpoint" interface="generatedNs:HTTPBasicAuthIntegrationServiceSOAPPortType" service="generatedNs:HTTPBasicAuthIntegrationServiceSOAP">
		<tns:description>Test the SOAP component in the provider role with a HTTP basic authentication</tns:description>

		<tns:test>
			<tns:description>HTTP basic authentication webservice call</tns:description>
		   <tns:mep>InOut</tns:mep>
		   <tns:operation xmlns:pet="http://petals.ow2.org/">pet:add</tns:operation>
		   <tns:messages>
				<tns:in>
					<tns:content><![CDATA[<pet:add xmlns:pet="http://petals.ow2.org/"><pet:a>3</pet:a><pet:b>4</pet:b></pet:add>]]></tns:content>
				</tns:in>
				<tns:out>
					<tns:content><![CDATA[<?xml version="1.0" encoding="UTF-8"?><ns:addResponse xmlns:ns="http://petals.ow2.org/" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"><return>The result is 7</return></ns:addResponse>]]></tns:content>
				</tns:out>
				<tns:outack ack="Done" />
			</tns:messages>
		</tns:test>

	</tns:consumer>

	<tns:consumer endpoint="IntegrationServiceSOAPHttpsSoap11Endpoint" interface="generatedNs:HTTPSIntegrationServiceSOAPPortType" service="generatedNs:HTTPSIntegrationServiceSOAP">
		<tns:description>Test the SOAP component in the provider role with a HTTPS partner webservice</tns:description>

		<tns:test>
			<tns:description>HTTPS webservice call</tns:description>
		   <tns:mep>InOut</tns:mep>
		   <tns:operation xmlns:pet="http://petals.ow2.org/">pet:add</tns:operation>
		   <tns:messages>
				<tns:in>
					<tns:content><![CDATA[<pet:add xmlns:pet="http://petals.ow2.org/"><pet:a>3</pet:a><pet:b>4</pet:b></pet:add>]]></tns:content>
				</tns:in>
				<tns:out>
					<tns:content><![CDATA[<?xml version="1.0" encoding="UTF-8"?><ns:addResponse xmlns:ns="http://petals.ow2.org/" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"><return>The result is 7</return></ns:addResponse>]]></tns:content>
				</tns:out>
				<tns:outack ack="Done" />
			</tns:messages>
		</tns:test>

	</tns:consumer>

	<tns:consumer endpoint="Axis1IntegrationServiceSOAP" interface="generatedNs:Axis1IntegrationService" service="generatedNs:Axis1IntegrationService">
		<tns:description>Test the SOAP component in the provider role with an Axis 1 webservice stack</tns:description>

		<tns:test>
			<tns:description>Returned Axis 1 partner fault test</tns:description>
		   <tns:mep>InOut</tns:mep>
		   <tns:operation xmlns:pet="http://petals.ow2.org/">pet:axis1Fault</tns:operation>
		   <tns:messages>
				<tns:in>
					<tns:content><![CDATA[<pet:axis1Fault xmlns:pet="http://petals.ow2.org/" />]]></tns:content>
				</tns:in>
				<tns:fault>
					<tns:content><![CDATA[<?xml version="1.0" encoding="UTF-8"?><soapenv:Fault xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapui="http://schemas.xmlsoap.org/soap/envelope/"><faultcode>soapui:SoapUI</faultcode><faultstring>Test SOAP Fault</faultstring><detail>
            <Exception>org.ow2.petals.soapui.TestFault: It is a test SOAP fault</Exception>
         </detail></soapenv:Fault>]]></tns:content>
				</tns:fault>
				<tns:faultack ack="Done" />
			</tns:messages>
		</tns:test>

		<tns:test>
			<tns:description>Multiref test</tns:description>
		   <tns:mep>InOut</tns:mep>
		   <tns:operation xmlns:pet="http://petals.ow2.org/">pet:axis1Fault</tns:operation>
		   <tns:messages>
				<tns:in>
					<tns:content><![CDATA[<pet:multiref xmlns:pet="http://petals.ow2.org/" />]]></tns:content>
				</tns:in>
				<tns:out>
					<tns:content><![CDATA[<?xml version="1.0" encoding="UTF-8"?><pet:multirefResponse xmlns:pet="http://petals.ow2.org/" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" soapenv:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">
      	<pet:multirefReturn xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" href="#id0" id="id0" soapenc:root="0" soapenv:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" xsi:type="pet:multirefReturn">
         <rStr xsi:type="xsd:string">string</rStr>
         <rInt xsi:type="xsd:int">4</rInt>
         <rFloat xsi:type="xsd:float">7.3</rFloat>
      </pet:multirefReturn>
      </pet:multirefResponse>]]></tns:content>
				</tns:out>
				<tns:outack ack="Done" />
			</tns:messages>
		</tns:test>

	</tns:consumer>

	<tns:consumer endpoint="FaultIntegrationServiceSOAP" interface="generatedNs:FaultIntegrationService" service="generatedNs:FaultIntegrationService">
		<tns:description>Test the SOAP component in the provider role</tns:description>

		<tns:test>
			<tns:description>Returned partner fault test</tns:description>
		   <tns:mep>InOut</tns:mep>
		   <tns:operation xmlns:pet="http://petals.ow2.org/">pet:fault</tns:operation>
		   <tns:messages>
				<tns:in>
					<tns:content><![CDATA[<pet:fault xmlns:pet="http://petals.ow2.org/" />]]></tns:content>
				</tns:in>
				<tns:fault>
					<tns:content><![CDATA[<?xml version="1.0" encoding="UTF-8"?><soapenv:Fault xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapui="http://schemas.xmlsoap.org/soap/envelope/"><faultcode>soapui:SoapUI</faultcode><faultstring>Test SOAP Fault</faultstring><detail>
            <Exception>org.ow2.petals.soapui.TestFault: It is a test SOAP fault</Exception>
         </detail></soapenv:Fault>]]></tns:content>
				</tns:fault>
				<tns:faultack ack="Done" />
			</tns:messages>
		</tns:test>

	</tns:consumer>

	<tns:consumer endpoint="TimeOutIntegrationServiceSOAP" interface="generatedNs:TimeOutIntegrationService" service="generatedNs:TimeOutIntegrationService">
		<tns:description>Test the SOAP component in the provider role</tns:description>

		<tns:test>
			<tns:description>Timeout test in the provider role</tns:description>
		   <tns:mep>InOut</tns:mep>
		   <tns:operation xmlns:pet="http://petals.ow2.org/">pet:multiply</tns:operation>
		   <tns:messages>
				<tns:in>
					<tns:content><![CDATA[<pet:multiply xmlns:pet="http://petals.ow2.org/" />]]></tns:content>
				</tns:in>
				<tns:fault>
					<tns:content regularExpression="true">&lt;\?xml version="1\.0" encoding="UTF-8"\?&gt;&lt;soapenv:Fault xmlns:soapenv="http://schemas\.xmlsoap\.org/soap/envelope/"&gt;&lt;faultcode&gt;soapenv:Server&lt;/faultcode&gt;&lt;faultstring&gt;org\.apache\.axis2\.AxisFault: Read timed out.*&lt;/faultstring&gt;.*&lt;/soapenv:Fault&gt;</tns:content>
				</tns:fault>
				<tns:faultack ack="Done" />
			</tns:messages>
		</tns:test>

	</tns:consumer>

</tns:integration>
